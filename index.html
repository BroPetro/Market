<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–≤–µ—Å—Ç: –û—Ä–≥–∞–Ω–∏ —Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–≥–∞–Ω—ñ–≤ —Ç–≤–∞—Ä–∏–Ω</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    .container {
      max-width: 800px;
      padding: 30px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
    }
    h2 {
      font-size: 2.5em;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    button {
      margin: 10px;
      padding: 15px 30px;
      font-size: 1.2em;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: 0.3s;
      background: #ff6f61;
      color: #fff;
      text-transform: uppercase;
    }
    button:hover {
      background: #e65b50;
      transform: scale(1.05);
    }
    #answers button {
      display: block;
      width: 80%;
      margin: 10px auto;
      background: #4a90e2;
      color: #fff;
      font-size: 1.1em;
    }
    #answers button:hover {
      background: #357abd;
    }
    .correct {
      background: #2ecc71 !important;
      animation: pop 0.5s ease;
    }
    .incorrect {
      background: #e74c3c !important;
      animation: shake 0.5s ease;
    }
    #qr-code {
      margin: 20px auto;
      display: block;
    }
    #home-button {
      background: #3498db;
    }
    #home-button:hover {
      background: #2980b9;
    }
    #progress, #leaderboard {
      margin: 20px 0;
      font-size: 1.1em;
    }
    #leaderboard ul {
      list-style: none;
      padding: 0;
    }
    #leaderboard ul li {
      padding: 5px 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      margin: 5px 0;
    }
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    @media (max-width: 768px) {
      .container { padding: 20px; }
      h2 { font-size: 1.8em; }
      button { font-size: 1em; padding: 10px 20px; }
      #answers button { font-size: 1em; }
    }
  </style>
</head>
<body>
  <div class="container" id="main-container">
    <div id="mode-selection">
      <h2>–û–±–µ—Ä–∏ —Ä–µ–∂–∏–º –≥—Ä–∏</h2>
      <button onclick="startSinglePlayer()">–û–¥–∏–Ω–æ—á–Ω–∞ –≥—Ä–∞</button>
      <button onclick="startMultiPlayer()">–ë–∞–≥–∞—Ç–æ–∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∞ –≥—Ä–∞</button>
    </div>
  </div>

  <script>
    const quiz = [
      {question: "–û—Å—Ç–∞—Ç–æ—á–Ω–∏–π —Ö–∞–∑—è—ó–Ω —Ü–µ?", answers: ["–¶–µ –Ω–∞—É–∫–∞ —â–æ –≤–∏–≤—á–∞—î –≥–µ–ª—å–º—ñ–Ω—Ç—ñ–≤", "–û—Ä–≥–∞–Ω—ñ–∑–º, –≤ —è–∫–æ–º—É –ø–∞—Ä–∞–∑–∏—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–∞—Å—Ç–∏–Ω—É —Å–≤–æ–≥–æ –∂–∏—Ç—Ç—è", "–û—Ä–≥–∞–Ω—ñ–∑–º, –≤ —è–∫–æ–º—É –ø–∞—Ä–∞–∑–∏—Ç—É—î –¥–æ—Ä–æ—Å–ª–∞ –æ—Å–æ–±–∞"], correct: 2},
      {question: "–ö–æ—Ç—è—á–∏–π —Å–∏—Å—É–Ω: —Ö—Ç–æ –ø—Ä–æ–º—ñ–∂–Ω–∏–π —Ö–∞–∑—è—ó–Ω?", answers: ["–†–∏–±–∞", "–¢–≤–∞—Ä–∏–Ω–∏", "–ú–æ–ª—é—Å–∫, –∫–æ—Ä–æ–ø–æ–≤—ñ"], correct: 2},
      {question: "–•—Ç–æ –æ—Å—Ç–∞—Ç–æ—á–Ω–∏–π —Ö–∞–∑—è—ó–Ω –±–∏—á–∞—á–æ–≥–æ —Ü—ñ–ø'—è–∫–∞?", answers: ["–õ—é–¥–∏–Ω–∞", "–¢–≤–∞—Ä–∏–Ω–∏", "–í—Å—ñ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ñ"], correct: 0},
      {question: "–ï—Ö—ñ–Ω–æ–∫–æ–∫: —Ö—Ç–æ –ø—Ä–æ–º—ñ–∂–Ω–∏–π —Ö–∞–∑—è—ó–Ω?", answers: ["–õ—é–¥–∏–Ω–∞", "–†–∏–±–∞", "–í–†–•"], correct: 2},
      {question: "–ö—ñ–ª—å—á–∞—Å—Ç—ñ —á–µ—Ä–≤–∏ –¥–∏—Ö–∞—é—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é?", answers: ["–ü–æ–≤–µ—Ä—Ö–Ω—é —Ç—ñ–ª–∞", "–õ–µ–≥–µ–Ω—ñ", "–ó—è–±—Ä–∞"], correct: 0},
      {question: "–Ø–∫–µ —Ä–æ–∑–º–Ω–æ–∂–µ–Ω–Ω—è –≤ –∫—ñ–ª—å—á–∞—Å—Ç–∏—Ö —á–µ—Ä–≤—ñ–≤?", answers: ["–°—Ç–∞—Ç–µ–≤–µ", "–ù–µ —Å—Ç–∞—Ç–µ–≤–µ", "–†–æ–∑–¥—ñ–ª—å–Ω–æ —Å—Ç–∞—Ç–µ–≤–µ"], correct: 2},
      {question: "–í–†–• —Ü–µ --", answers: ["–Ø–±–ª—É–∫–æ", "–í–µ–ª–∏–∫–∞ —Ä–æ–≥–∞—Ç–∞ —Ö—É–¥–æ–±–∞", "–ì—Ä—É—à–∞"], correct: 1},
      {question: "–•—Ç–æ —î –æ—Å—Ç–∞—Ç–æ—á–Ω–∏–º —Ö–∞–∑—è—ó–Ω–æ–º —Å—Ç—å–æ–∂–∞–∫–∞ —à–∏—Ä–æ–∫–æ–≥–æ?", answers: ["–õ—é–¥–∏–Ω–∞, —Ä–∏–±–æ—ó–¥–Ω—ñ —Å–∞–≤—Ü—ñ", "–†–∏–±–∞", "–ú–æ–ª—é—Å–∫–∏"], correct: 0},
      {question: "–ì–µ–ª—å–º—ñ–Ω—Ç–æ–ª–æ–≥—ñ—è —Ü–µ --", answers: ["–ù–∞—É–∫–∞ —â–æ –≤–∏–≤—á–∞—î “ë—Ä—É–Ω—Ç–∏", "–ù–∞—É–∫–∞ —â–æ –≤–∏–≤—á–∞—î —Ä–æ—Å–ª–∏–Ω–∏", "–ù–∞—É–∫–∞, —â–æ –≤–∏–≤—á–∞—î –≥–µ–ª—å–º—ñ–Ω—Ç—ñ–≤"], correct: 2},
      {question: "–ö—ñ–ª—å—á–∞—Å—Ç—ñ —á–µ—Ä–≤–∏ –ø–µ—Ä–µ—Å—É–≤–∞—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é", answers: ["–ù—ñ–≥", "–©–µ—Ç–∏–Ω–æ–∫", "–†—É–∫"], correct: 1},
    ];

    let currentQuestion = 0;
    let score = 0;
    let players = {}; // –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –≥—Ä–∞–≤—Ü—ñ–≤ –¥–ª—è P2P
    let peerConnection;
    let dataChannel;

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è WebRTC
    function initializePeerConnection() {
      const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
      peerConnection = new RTCPeerConnection(configuration);

      dataChannel = peerConnection.createDataChannel("chat");
      dataChannel.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === "scoreUpdate") {
          players[data.player] = data.score;
          updateLeaderboard();
        }
      };

      peerConnection.onicecandidate = (event) => {
        if (event.candidate) {
          // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —ñ–Ω—à–æ–º—É –≥—Ä–∞–≤—Ü–µ–≤—ñ (–ø–æ—Ç—Ä—ñ–±–µ–Ω —Å–µ—Ä–≤–µ—Ä –∞–±–æ —Ä—É—á–Ω–µ –≤–≤–µ–¥–µ–Ω–Ω—è)
          console.log("ICE candidate:", event.candidate);
        }
      };

      peerConnection.ondatachannel = (event) => {
        dataChannel = event.channel;
        dataChannel.onmessage = (event) => {
          const data = JSON.parse(event.data);
          if (data.type === "scoreUpdate") {
            players[data.player] = data.score;
            updateLeaderboard();
          }
        };
      };
    }

    function startSinglePlayer() {
      document.getElementById("main-container").innerHTML = `
        <h2 id="question"></h2>
        <div id="answers"></div>
        <p id="progress">–ü–∏—Ç–∞–Ω–Ω—è: 1 / ${quiz.length}</p>
        <p id="score">–û—á–∫–∏: 0</p>
        <button onclick="restartQuiz()">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏</button>
        <button id="home-button" onclick="goHome()">üè† –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</button>
      `;
      loadQuestion();
    }

    function startMultiPlayer() {
      initializePeerConnection();
      const quizUrl = window.location.href;
      document.getElementById("main-container").innerHTML = `
        <h2>–ë–∞–≥–∞—Ç–æ–∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∞ –≥—Ä–∞</h2>
        <p>–°–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:</p>
        <div id="qr-code"></div>
        <p>–í–≤–µ–¥—ñ—Ç—å ID —ñ–Ω—à–æ–≥–æ –≥—Ä–∞–≤—Ü—è: <input type="text" id="peerId" placeholder="ID –≥—Ä–∞–≤—Ü—è"></p>
        <button onclick="connectToPeer()">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è</button>
        <button id="home-button" onclick="goHome()">üè† –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</button>
      `;
      new QRCode(document.getElementById("qr-code"), {
        text: quizUrl,
        width: 200,
        height: 200,
        colorDark: "#fff",
        colorLight: "transparent",
        correctLevel: QRCode.CorrectLevel.H
      });
    }

    async function connectToPeer() {
      const peerId = document.getElementById("peerId").value;
      const offer = await peerConnection.createOffer();
      await peerConnection.setLocalDescription(offer);
      // –¢—É—Ç –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ offer —ñ–Ω—à–æ–º—É –≥—Ä–∞–≤—Ü–µ–≤—ñ (—á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä –∞–±–æ –≤—Ä—É—á–Ω—É)
      console.log("Offer:", offer.sdp);
      dataChannel = peerConnection.createDataChannel("chat");
      dataChannel.onopen = () => startQuiz();
    }

    function startQuiz() {
      currentQuestion = 0;
      score = 0;
      players[generatePlayerId()] = 0; // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
      document.getElementById("main-container").innerHTML = `
        <h2 id="question"></h2>
        <div id="answers"></div>
        <p id="progress">–ü–∏—Ç–∞–Ω–Ω—è: 1 / ${quiz.length}</p>
        <p id="score">–û—á–∫–∏: 0</p>
        <div id="leaderboard"><h3>–õ—ñ–¥–µ—Ä–∏:</h3><ul></ul></div>
        <button onclick="restartQuiz()">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏</button>
        <button id="home-button" onclick="goHome()">üè† –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</button>
      `;
      loadQuestion();
      updateLeaderboard();
    }

    function goHome() {
      location.reload();
    }

    function loadQuestion() {
      document.getElementById("question").innerText = quiz[currentQuestion].question;
      let answersDiv = document.getElementById("answers");
      answersDiv.innerHTML = "";
      quiz[currentQuestion].answers.forEach((answer, index) => {
        let btn = document.createElement("button");
        btn.innerText = answer;
        btn.onclick = function() { checkAnswer(index, btn); };
        answersDiv.appendChild(btn);
      });
      document.getElementById("progress").innerText = `–ü–∏—Ç–∞–Ω–Ω—è: ${currentQuestion + 1} / ${quiz.length}`;
    }

    function checkAnswer(index, btn) {
      if (index === quiz[currentQuestion].correct) {
        score++;
        btn.classList.add('correct');
      } else {
        btn.classList.add('incorrect');
      }
      document.getElementById("score").innerText = "–û—á–∫–∏: " + score;
      if (dataChannel && dataChannel.readyState === "open") {
        dataChannel.send(JSON.stringify({ type: "scoreUpdate", player: generatePlayerId(), score }));
      }
      setTimeout(nextQuestion, 1000);
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < quiz.length) {
        loadQuestion();
      } else {
        document.getElementById("main-container").innerHTML = `
          <h2>–ö—ñ–Ω–µ—Ü—å –∫–≤–µ—Å—Ç—É!</h2>
          <p>–í–∞—à —Ä–∞—Ö—É–Ω–æ–∫: ${score} –∑ ${quiz.length}</p>
          <div id="leaderboard"><h3>–õ—ñ–¥–µ—Ä–∏:</h3><ul></ul></div>
          <button onclick="restartQuiz()">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏</button>
          <button id="home-button" onclick="goHome()">üè† –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</button>
        `;
        updateLeaderboard();
      }
    }

    function restartQuiz() {
      currentQuestion = 0;
      score = 0;
      startQuiz();
    }

    function generatePlayerId() {
      return 'player_' + Math.random().toString(36).substr(2, 9);
    }

    function updateLeaderboard() {
      const leaderboard = document.getElementById("leaderboard").querySelector("ul");
      leaderboard.innerHTML = "";
      Object.entries(players).sort(([, a], [, b]) => b - a).forEach(([player, score]) => {
        const li = document.createElement("li");
        li.textContent = `${player}: ${score} –æ—á–æ–∫`;
        leaderboard.appendChild(li);
      });
    }
  </script>
</body>
</html>
